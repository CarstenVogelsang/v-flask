<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% block meta %}{% endblock %}

    <title>{% block title %}{{ get_betreiber().name if get_betreiber() else 'v-flask App' }}{% endblock %}</title>

    {# CSS: Bootstrap 5, Tabler Icons, v-flask.css #}
    {% block head_css %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    {% set betreiber = get_betreiber() %}
    {% if betreiber and betreiber.google_fonts_url %}
    <link href="{{ betreiber.google_fonts_url }}" rel="stylesheet">
    {% endif %}
    <link rel="stylesheet" href="{{ url_for('v_flask_static.static', filename='tabler-icons/tabler-icons.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('v_flask_static.static', filename='css/v-flask.css') }}">
    {% endblock %}

    {# Dynamic Branding CSS Variables from Betreiber #}
    {% block branding_css %}
    {% set betreiber = get_betreiber() %}
    {% if betreiber %}
    <style>{{ betreiber.get_css_variables()|safe }}</style>
    {% endif %}
    {% endblock %}

    {# Additional CSS from child templates #}
    {% block extra_css %}{% endblock %}
</head>
<body class="d-flex flex-column min-vh-100">
    {% block body_start %}{% endblock %}

    {# Toast Container for Flash Messages #}
    {% block toast_container %}
    <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1100;">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div class="toast align-items-center text-bg-{{ category if category in ['success', 'danger', 'warning', 'info'] else 'info' }} border-0"
             role="alert" aria-live="assertive" aria-atomic="true"
             data-bs-autohide="true" data-bs-delay="5000">
            <div class="d-flex">
                <div class="toast-body">{{ message }}</div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="SchlieÃŸen"></button>
            </div>
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}
    </div>
    {% endblock %}

    {# Main Content - Full page, no container #}
    {% block main %}
    <main class="flex-grow-1">
        {% block content %}{% endblock %}
    </main>
    {% endblock %}

    {# Modals #}
    {% block modals %}{% endblock %}

    {% block body_end %}{% endblock %}

    {# JavaScript #}
    {% block scripts_base %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('v_flask_static.static', filename='js/toast-init.js') }}"></script>
    {% endblock %}

    {% block extra_js %}{% endblock %}
</body>
</html>
