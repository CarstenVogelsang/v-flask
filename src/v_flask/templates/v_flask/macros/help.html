{#
    Help Icon Macro with Modal

    IMPORTANT: Import with "with context" to access template context!

    Usage:
        from "v_flask/macros/help.html" import help_icon with context

        <div class="card-header">
            Branchen help_icon('kunden.detail.branchen', 'Hilfe zu Branchen')
        </div>

    Prerequisites:
        - Context processor must provide get_help_text(schluessel) function
        - Model: Hilfetext with fields: schluessel, titel, inhalt_markdown, aktiv

    Parameters:
        - schluessel: Unique key for help text (e.g., 'modul.seite.bereich')
        - titel: Fallback title if help text not found or no title set
        - light: True for white icons on dark backgrounds
#}

{% macro help_icon(schluessel, titel=None, light=false) %}
{% if get_help_text is defined %}
{% set help = get_help_text(schluessel) %}
{% if help and help.aktiv %}
<button type="button"
        class="btn btn-sm btn-link text-decoration-none p-0 ms-2 help-icon-btn"
        data-bs-toggle="modal"
        data-bs-target="#helpModal_{{ schluessel|replace('.', '_') }}"
        title="Hilfe anzeigen">
    <i class="ti ti-info-circle fs-5 {{ 'text-white-50' if light else 'text-muted' }}"></i>
</button>

<div class="modal fade help-modal" id="helpModal_{{ schluessel|replace('.', '_') }}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="ti ti-info-circle text-info me-2"></i>
                    {{ help.titel or titel or 'Hilfe' }}
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Schließen"></button>
            </div>
            <div class="modal-body help-content">
                {% if help.inhalt_markdown %}
                {{ help.inhalt_markdown|markdown|safe }}
                {% else %}
                <p class="text-muted">Keine Hilfe verfügbar.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endif %}
{% endmacro %}


{#
    Standalone Help Modal (without button)

    Use when you need to trigger the modal from somewhere else.

    Usage:
        from "v_flask/macros/help.html" import help_modal with context

        help_modal('kunden.detail.branchen')

        <button data-bs-toggle="modal" data-bs-target="#helpModal_kunden_detail_branchen">
            Custom trigger
        </button>
#}

{% macro help_modal(schluessel, titel=None) %}
{% if get_help_text is defined %}
{% set help = get_help_text(schluessel) %}
{% if help and help.aktiv %}
<div class="modal fade help-modal" id="helpModal_{{ schluessel|replace('.', '_') }}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="ti ti-info-circle text-info me-2"></i>
                    {{ help.titel or titel or 'Hilfe' }}
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Schließen"></button>
            </div>
            <div class="modal-body help-content">
                {% if help.inhalt_markdown %}
                {{ help.inhalt_markdown|markdown|safe }}
                {% else %}
                <p class="text-muted">Keine Hilfe verfügbar.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endif %}
{% endmacro %}


{#
    Simple Info Tooltip (no database lookup)

    For simple inline help without database lookup.

    Usage:
        from "v_flask/macros/help.html" import info_tooltip

        Feldname info_tooltip('Diese Information wird...')
#}

{% macro info_tooltip(text, light=false) %}
<span class="ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="{{ text }}">
    <i class="ti ti-info-circle {{ 'text-white-50' if light else 'text-muted' }}"></i>
</span>
{% endmacro %}
